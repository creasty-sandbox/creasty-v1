(function(g,f){var b,c,d,e,h,a;a={required:"この項目は必須です。",invalid:"入力された値が不正です。",maxlen:"入力が長ぎます。${1} 文字以下にして下さい。",minlen:"入力が短すぎます。${1} 文字以上ご入力下さい。",maximum:"入力された値が大き過ぎます。${1} 以下をご入力下さい。",minimum:"入力された値が小さ過ぎます。${1} 以上をご入力下さい。",maxselect:"選択された項目が多すぎます。${1} 個以内で選択して下さい。",minselect:"選択された項目が少なすぎます。${1} 個以上を選択して下さい。",select:"選択された項目の数が不正です。${1} 個を選択して下さい。",success:"送信しました。ありがとうございました。",fail:"ご入力された内容の ${1} 箇所に不備があります。",rejected:"送信できませんでした。しばらく待ってからもう一度お試し下さい。"};h=function(j){var i;if(g.isArray(j)){if(a[j[0]]){return a[j[0]].replace(/\$\{(\d+)\}/g,function(l,k){return j[+k];});}else{return j[0];}}else{return(i=a[j])!=null?i:j;}};e=function(j,k,i){return j.removeClass(i).addClass(k);};c=(function(){function i(j){this.Validator=j;this.cache={};this.cls=this.Validator.config.className;this.html=this.Validator.config.html;}i.prototype.getElement=function(j,k){var l,n,m;if(this.cache[j]){return this.cache[j];}m=g("#"+this.Validator.getName(j));if(this.Validator.config.groupSelector){n=m.closest(this.Validator.config.groupSelector);}else{n=m.parent();}l=g(k);n.append(l);return this.cache[j]={target:m,box:l,group:n};};i.prototype._message=function(j,l){var k;k=this.getElement(j,this.html.message);l=h(l);k.box.removeClass("hide");if("valid"===l){e(k.box,this.cls.vaild,this.cls.invalid);return e(k.group,"success","error");}else{k.box.text(l);e(k.box,this.cls.invalid,this.cls.vaild);return e(k.group,"error","success");}};i.prototype._hide=function(j){var k;k=this.getElement(j);e(k.box,this.cls.valid,this.cls.invalid);k.group.removeClass("error success");return k.box.addClass("hide");};i.prototype.hideAll=function(){var k,j;j=[];for(k in this.cache){j.push(this._hide(k));}return j;};i.prototype.message=function(l){var m,k,j;j=[];for(k in l){m=l[k];j.push(this._message(k,m));}return j;};i.prototype.notification=function(l,k){var j;j=this.getElement("submitButton",this.html.notification);j.box.removeClass("hide");if(l){j.box.text(h(["success",k]));return e(j.box,this.cls.success,this.cls.fail);}else{if(k>0){j.box.text(h(["fail",k]));return e(j.box,this.cls.fail,this.cls.success);}else{j.box.text(h("rejected"));return e(j.box,this.cls.fail,this.cls.success);}}};return i;})();b=(function(){function i(k,j){var l=this;this.image=k;this.input=j;this.path=this.image.attr("src");this.image.on("click",function(){return l.refresh();});}i.prototype.refresh=function(){var j;j=Math.floor(Math.random()*100000);this.image.attr("src",this.path+"?t="+j);return this.input.val("").focus();};return i;})();d=(function(){function i(k,j){var l;this.form=k;this.config=j;this.config=g.extend({prefix:null,groupSelector:".control-group",html:{message:'<p class="validation-message"></p>',notification:'<p class="validation-notification"></p>'},className:{vaild:"hide",invalid:"show",success:"success",fail:"fail"},init:g.noop,beforeSubmit:function(){return true;},success:g.noop,fail:g.noop},g.FormValidator.defaults,this.config);if(!this.config.prefix){l=/#([\w\-]+)/.exec(this.form.selector);this.config.prefix=(l!=null?l:["","form"])[1];}this.Messaging=new c(this);this.submitButton=this.form.find("button[type=submit]");this.submitButton.eq(0).attr("id",this.getName("submitButton"));if(g("#captcha-image").length===1){this.captchaImage=g("#captcha-image");this.captchaInput=g("#"+this.getName("captcha"));new b(this.captchaImage,this.captchaInput);}this.config.init(this.form,this);this.init();this.config.afterSetup(this.form,this);}i.prototype.init=function(){var j=this;return this.form.ajaxForm({dataType:"json",data:{_ajax_call:1},beforeSubmit:function(l,k){j.disableButton();return j.config.beforeSubmit(j.form,j);},success:function(l,k,m){j.enableButton();j.Messaging.hideAll();j.Messaging.notification(l.processed,l.error_count);j.Messaging.message(l.error_message);if(l.processed){j.config.success(j.form,j);return true;}else{j.config.fail(j.form,j);return false;}},error:function(){j.enableButton();return j.config.fail(j.form,j);}});};i.prototype.getName=function(j){return this.config.prefix+"-"+j;};i.prototype.disableButton=function(){return this.submitButton.attr("disabled",true).addClass("loading");};i.prototype.enableButton=function(){return this.submitButton.attr("disabled",false).removeClass("loading");};return i;})();g.fn.FormValidator=function(i){new d(this,i);return this;};return g.FormValidator={text:a,defaults:{}};})(jQuery,window);